<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js"></script>
  <script src="../../pyjamas/pjs.js"></script>
</head>

<body>
<h1>Interactive Python</h1>
<h2>Canvas</h2>
<canvas id="figure" width="800" height="400" style="border:1px solid #000000;"></canvas>
<p id="output"></p>
<div id="status""></div><br>

<h2>Terminal</h2>
<div id="terminal"></div>

<script>

var bounds =  {x: 800, y: 400};

function clc(ctx, bounds) {
    // clear canvas
    ctx.fillStyle = "#000000";
    ctx.fillRect(0, 0, bounds.x, bounds.y);
}

function draw_agent(ctx, agent) {
    // draw circle centered at (x, y): (agent[0], agent[1])
    ctx.strokeStyle = "#ff0000";
    ctx.beginPath();
    ctx.arc(agent[0], agent[1], 40, 0, 2 * Math.PI);
    ctx.stroke();
}

function draw_state(canvas_id, agent) {
    // clear canvas and draw agent
    var canvas = document.getElementById(canvas_id);
    var ctx = canvas.getContext("2d");
    //clc(ctx, bounds);
    draw_agent(ctx, agent);
}

async function main() {
    // set "status" as the standard output DOM element.
    await pjs.init("status"); 
    // create a python interpeter inside the "terminal" DOM element.
    await pjs.terminal("terminal");
    const init_script = `
        import numpy as np
    `;
    await pjs.run(init_script);
    //attach a callback function to the canvas
    var canvas = document.getElementById("figure");
    var output = document.getElementById("output");
    canvas.onmousemove = function(event){
        const box = event.currentTarget.getBoundingClientRect();
        const mouse = [
            event.clientX - box.left,
            event.clientY - box.top
        ];
        pjs.run("x = np.array([" + mouse.toString() + "])").then(() => {
            agent = pjs.get("x").toJs();
            draw_state("figure", agent);
            output.innerHTML = agent;
        })
    };
}

main();

</script>

</body>
</html>